From ad74a11abf9d62389a6bd74a6edf9cd73e36c8f7 Mon Sep 17 00:00:00 2001
From: Sl√°vek Banko <slavek.banko@axis.cz>
Date: Mon, 09 Mar 2015 21:33:13 +0000
Subject: Fix security issue CVE-2014-0190

[taken from RedHat Qt3 patches]
---
diff --git a/src/kernel/qasyncimageio.cpp b/src/kernel/qasyncimageio.cpp
index 8ecd1eb..e16125b 100644
--- a/src/kernel/qasyncimageio.cpp
+++ b/src/kernel/qasyncimageio.cpp
@@ -904,7 +904,12 @@ int QGIFFormat::decode(QImage& img, QImageConsumer* consumer,
 		    sheight = newtop + newheight;
 
 		if (img.isNull()) {
-		    img.create(swidth, sheight, 32);
+		    if (!img.create(swidth, sheight, 32)) {
+			// Check if the attempt to create the image failed. If
+			// it did, the image is broken and we should give up.
+			state = Error;
+			return -1;
+		    }
 		    memset( img.bits(), 0, img.numBytes() );
 		    if (consumer) consumer->setSize(swidth, sheight);
 		}
--
cgit v0.9.0.2-52-g1de3
